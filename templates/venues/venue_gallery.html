{% extends 'base.html' %}
{% load static %}

{% block title %}Gallery - {{ venue.name }} - 360° Event Manager{% endblock %}

{% block extra_css %}
<style>
    .gallery-hero {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 60px 0;
        position: relative;
        overflow: hidden;
    }
    
    .gallery-hero::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="0.5"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
        opacity: 0.3;
    }
    
    .gallery-container {
        background: white;
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 15px 40px rgba(0,0,0,0.1);
        margin: 30px 0;
    }
    
    .gallery-filter {
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        margin-bottom: 30px;
    }
    
    .filter-btn {
        background: #f8f9fa;
        border: 2px solid transparent;
        color: #6c757d;
        padding: 10px 20px;
        border-radius: 25px;
        transition: all 0.3s ease;
        margin: 5px;
        font-weight: 600;
    }
    
    .filter-btn.active {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-color: #667eea;
        color: white;
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
    }
    
    .gallery-item {
        background: white;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        margin-bottom: 30px;
        transition: all 0.3s ease;
        cursor: pointer;
    }
    
    .gallery-item:hover {
        transform: translateY(-5px);
        box-shadow: 0 20px 40px rgba(0,0,0,0.15);
    }
    
    .gallery-image {
        width: 100%;
        height: 250px;
        object-fit: cover;
        transition: transform 0.3s ease;
    }
    
    .gallery-item:hover .gallery-image {
        transform: scale(1.05);
    }
    
    .gallery-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.7);
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    
    .gallery-item:hover .gallery-overlay {
        opacity: 1;
    }
    
    .gallery-overlay-btn {
        background: white;
        color: #333;
        border: none;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        transition: all 0.3s ease;
    }
    
    .gallery-overlay-btn:hover {
        transform: scale(1.1);
        background: #667eea;
        color: white;
    }
    
    .gallery-info {
        padding: 20px;
    }
    
    .gallery-caption {
        font-weight: 600;
        margin-bottom: 10px;
        color: #333;
    }
    
    .gallery-description {
        color: #6c757d;
        font-size: 0.9rem;
        margin-bottom: 0;
    }
    
    .gallery-stats {
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        margin-bottom: 30px;
    }
    
    .stat-item {
        text-align: center;
        padding: 20px;
    }
    
    .stat-number {
        font-size: 2rem;
        font-weight: 700;
        color: #667eea;
        margin-bottom: 5px;
    }
    
    .stat-label {
        color: #6c757d;
        font-weight: 600;
    }
    
    .lightbox {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.9);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 9999;
    }
    
    .lightbox.active {
        display: flex;
    }
    
    .lightbox-content {
        max-width: 90%;
        max-height: 90%;
        position: relative;
    }
    
    .lightbox-image {
        max-width: 100%;
        max-height: 100%;
        border-radius: 10px;
    }
    
    .lightbox-close {
        position: absolute;
        top: -50px;
        right: 0;
        background: white;
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        font-size: 1.5rem;
        cursor: pointer;
    }
    
    .lightbox-nav {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: white;
        border: none;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        font-size: 1.5rem;
        cursor: pointer;
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    
    .lightbox-prev {
        left: -70px;
    }
    
    .lightbox-next {
        right: -70px;
    }
</style>
{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="gallery-hero">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <h1 class="display-4 fw-bold mb-3">
                    <i class="fas fa-images me-3"></i>Photo Gallery
                </h1>
                <p class="lead mb-4">Explore {{ venue.name }} through our comprehensive photo collection</p>
                <div class="d-flex gap-3">
                    <a href="{% url 'venues:venue_detail' venue.id %}" class="btn btn-outline-light">
                        <i class="fas fa-arrow-left me-2"></i>Back to Venue
                    </a>
                                    <a href="{% url 'venues:venue_gallery_enhanced' venue.id %}" class="btn btn-light">
                    <i class="fas fa-images me-2"></i>Enhanced Gallery
                    </a>
                </div>
            </div>
            <div class="col-lg-4 text-center">
                <i class="fas fa-images" style="font-size: 6rem; opacity: 0.3;"></i>
            </div>
        </div>
    </div>
</section>

<!-- Gallery Stats -->
<section class="py-5">
    <div class="container">
        <div class="gallery-stats">
            <div class="row">
                <div class="col-md-3">
                    <div class="stat-item">
                        <div class="stat-number">{{ venue.images.count }}</div>
                        <div class="stat-label">Total Photos</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-item">
                        <div class="stat-number">{{ venue.capacity_max }}</div>
                        <div class="stat-label">Max Capacity</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-item">
                        <div class="stat-number">{{ venue.average_rating|floatformat:1 }}</div>
                        <div class="stat-label">Average Rating</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-item">
                        <div class="stat-number">₹{{ venue.base_price }}</div>
                        <div class="stat-label">Starting Price</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Gallery Filters -->
<section class="py-5 bg-light">
    <div class="container">
        <div class="gallery-filter">
            <h3 class="fw-bold mb-4">
                <i class="fas fa-filter me-2 text-primary"></i>Filter Photos
            </h3>
            <div class="d-flex flex-wrap">
                <button class="filter-btn active" data-filter="all">All Photos</button>
                <button class="filter-btn" data-filter="exterior">Exterior</button>
                <button class="filter-btn" data-filter="interior">Interior</button>
                <button class="filter-btn" data-filter="events">Events</button>
                <button class="filter-btn" data-filter="amenities">Amenities</button>
                <button class="filter-btn" data-filter="details">Details</button>
            </div>
        </div>
    </div>
</section>

<!-- Gallery Grid -->
<section class="py-5">
    <div class="container">
        <div class="gallery-container">
            <div class="row" id="galleryGrid">
                {% for image in venue.images.all %}
                <div class="col-lg-4 col-md-6 gallery-item" data-category="{{ image.category|default:'general' }}">
                    <div class="position-relative">
                        <img src="{{ image.image.url }}" alt="{{ image.caption|default:venue.name }}" class="gallery-image">
                        <div class="gallery-overlay">
                            <button class="gallery-overlay-btn" onclick="openLightbox('{{ image.image.url }}', '{{ image.caption|default:venue.name }}')">
                                <i class="fas fa-expand"></i>
                            </button>
                        </div>
                    </div>
                    <div class="gallery-info">
                        <div class="gallery-caption">{{ image.caption|default:"Venue Photo" }}</div>
                        <p class="gallery-description">{{ image.description|default:"Beautiful venue photo showcasing the space and amenities." }}</p>
                    </div>
                </div>
                {% empty %}
                <div class="col-12 text-center">
                    <div class="py-5">
                        <i class="fas fa-images fa-4x text-muted mb-3"></i>
                        <h4 class="text-muted">No Photos Available</h4>
                        <p class="text-muted">Photos will be added soon.</p>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</section>

<!-- Lightbox -->
<div class="lightbox" id="lightbox">
    <div class="lightbox-content">
        <button class="lightbox-close" onclick="closeLightbox()">
            <i class="fas fa-times"></i>
        </button>
        <button class="lightbox-nav lightbox-prev" onclick="previousImage()">
            <i class="fas fa-chevron-left"></i>
        </button>
        <button class="lightbox-nav lightbox-next" onclick="nextImage()">
            <i class="fas fa-chevron-right"></i>
        </button>
        <img src="" alt="" class="lightbox-image" id="lightboxImage">
        <div class="text-center mt-3">
            <h5 class="text-white" id="lightboxCaption"></h5>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Gallery filter functionality
    const filterButtons = document.querySelectorAll('.filter-btn');
    const galleryItems = document.querySelectorAll('.gallery-item');
    
    filterButtons.forEach(button => {
        button.addEventListener('click', function() {
            // Remove active class from all buttons
            filterButtons.forEach(btn => btn.classList.remove('active'));
            // Add active class to clicked button
            this.classList.add('active');
            
            const filter = this.getAttribute('data-filter');
            
            galleryItems.forEach(item => {
                const category = item.getAttribute('data-category');
                if (filter === 'all' || category === filter) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        });
    });
    
    // Gallery item click animation
    galleryItems.forEach(item => {
        item.addEventListener('click', function() {
            this.style.transform = 'scale(0.95)';
            setTimeout(() => {
                this.style.transform = 'translateY(-5px)';
            }, 150);
        });
    });
});

// Lightbox functionality
let currentImageIndex = 0;
let images = [];

function openLightbox(imageSrc, caption) {
    images = Array.from(document.querySelectorAll('.gallery-image')).map(img => ({
        src: img.src,
        caption: img.alt
    }));
    
    currentImageIndex = images.findIndex(img => img.src === imageSrc);
    
    const lightbox = document.getElementById('lightbox');
    const lightboxImage = document.getElementById('lightboxImage');
    const lightboxCaption = document.getElementById('lightboxCaption');
    
    lightboxImage.src = imageSrc;
    lightboxCaption.textContent = caption;
    lightbox.classList.add('active');
    
    document.body.style.overflow = 'hidden';
}

function closeLightbox() {
    const lightbox = document.getElementById('lightbox');
    lightbox.classList.remove('active');
    document.body.style.overflow = 'auto';
}

function previousImage() {
    currentImageIndex = (currentImageIndex - 1 + images.length) % images.length;
    updateLightboxImage();
}

function nextImage() {
    currentImageIndex = (currentImageIndex + 1) % images.length;
    updateLightboxImage();
}

function updateLightboxImage() {
    const lightboxImage = document.getElementById('lightboxImage');
    const lightboxCaption = document.getElementById('lightboxCaption');
    
    lightboxImage.src = images[currentImageIndex].src;
    lightboxCaption.textContent = images[currentImageIndex].caption;
}

// Close lightbox on escape key
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closeLightbox();
    } else if (e.key === 'ArrowLeft') {
        previousImage();
    } else if (e.key === 'ArrowRight') {
        nextImage();
    }
});

// Close lightbox when clicking outside
document.getElementById('lightbox').addEventListener('click', function(e) {
    if (e.target === this) {
        closeLightbox();
    }
});
</script>
{% endblock %} 